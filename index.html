<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Camera/Location Access</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
      }
      #video {
        width: 100%;
        max-width: 100%;
        border-radius: 10px;
        height: calc(100vh - 70px);
        object-fit: fill;
        border-radius: 6px;
        box-shadow: 0 0 5px rgba(128, 128, 128, 0.456);
      }
      #location {
        margin-bottom: 1rem;
      }
      h1 {
        margin: 10px;
        color: #42a5f5;
      }
      .accessedFeilds {
        position: relative;
        width: 90%;
        margin: auto;
      }
      .accessedFeilds #location {
        border: 1px solid white;
        position: absolute;
        bottom: 10px;
        background: black;
        color: white;
        padding: 10px 15px;
        font-size: 14px;
        border-radius: 6px;
        left: 20px;
      }
      #captureBtn {
        position: absolute;
        top: 10px;
        right: 20px;
        background: #42a5f5;
        color: white;
        border-radius: 6px;
        border: 2px solid white;
        padding: 10px 20px;
      }
      #captureBtn:hover {
        cursor: pointer;
        background: white;
        color: #42a5f5;
        border: 2px solid #42a5f5;
      }

      #capturedSection {
        display: none;
        position: absolute;
        bottom: 0;
        right: 0;
        background: white;
        padding: 10px;
        border-radius: 10px;
      }

      #capturedSection img {
        width: 300px;
        margin-bottom: 10px;
      }
      #capturedLocation {
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="./about.html">go to</a>
    </header>
    <h1>Camera and Location Access</h1>
    <div class="accessedFeilds">
      <video id="video" autoplay></video>
      <div id="location">Location: Not fetched</div>
      <button id="captureBtn">Capture</button>
    </div>

    <div id="capturedSection">
      <h3>Captured Image:</h3>
      <p id="capturedLocation"></p>
      <img id="capturedImage" alt="Captured image will appear here" />
    </div>

    <script>
      const video = document.getElementById("video");
      const captureBtn = document.getElementById("captureBtn");
      const capturedImage = document.getElementById("capturedImage");
      const capturedSection = document.getElementById("capturedSection");
      const locationText = document.getElementById("location");

      async function startCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          video.srcObject = stream;
        } catch (error) {
          alert("Camera access denied or not supported.");
          console.error(error);
        }
      }
      function trackLocation() {
        if ("geolocation" in navigator) {
          navigator.geolocation.watchPosition(
            (position) => {
              currentLatitude = position.coords.latitude;
              currentLongitude = position.coords.longitude;
              locationText.textContent = `Live Location: Latitude ${currentLatitude.toFixed(
                6
              )}, Longitude ${currentLongitude.toFixed(6)}`;
            },
            (error) => {
              alert("Location access denied or unavailable.");
              console.error(error);
            },
            {
              enableHighAccuracy: true,
              maximumAge: 1000,
            }
          );
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      captureBtn.addEventListener("click", () => {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const context = canvas.getContext("2d");
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        const dataUrl = canvas.toDataURL("image/png");
        capturedImage.src = dataUrl;

        if (currentLatitude && currentLongitude) {
          capturedLocation.textContent = `Captured Location: Latitude ${currentLatitude.toFixed(
            6
          )}, Longitude ${currentLongitude.toFixed(6)}`;
        } else {
          capturedLocation.textContent = `Captured Location: Not available`;
        }

        // Show the section
        capturedSection.style.display = "block";
      });

      startCamera();
      trackLocation();
    </script>
  </body>
</html>
